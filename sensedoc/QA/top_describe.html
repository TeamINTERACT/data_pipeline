<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="B. Thierry, Spherelab" />


<title>INTERACT | SenseDoc Quality checks</title>

<script src="top_describe_files/header-attrs-2.29/header-attrs.js"></script>
<script src="top_describe_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="top_describe_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="top_describe_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="top_describe_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="top_describe_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="top_describe_files/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="top_describe_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="top_describe_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="top_describe_files/navigation-1.1/tabsets.js"></script>
<script src="top_describe_files/navigation-1.1/codefolding.js"></script>
<link href="top_describe_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="top_describe_files/highlightjs-9.12.0/highlight.js"></script>
<link href="top_describe_files/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="top_describe_files/pagedtable-1.1/js/pagedtable.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">INTERACT | SenseDoc Quality checks</h1>
<h4 class="author">B. Thierry, Spherelab</h4>
<h4 class="date">25 September, 2025</h4>

</div>


<div id="qa-objectives" class="section level1" number="1">
<h1><span class="header-section-number">1</span> QA objectives</h1>
<p>Create summary statistics (see <code>QA</code> subfolder):</p>
<ul>
<li>date ranges</li>
<li>number of days of data per participant</li>
<li>min, max, SD distributions</li>
<li>GPS locations</li>
<li>[Sept.Â 2025] Step statistics</li>
</ul>
</div>
<div id="data-coverage" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Data coverage</h1>
<div id="get-data-from-database" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Get data from
database</h2>
<pre class="sql"><code>select city_id, wave_id, interact_id, sd_id
    ,min(utcdate) start_time, max(utcdate) end_time
    ,max(utcdate) - min(utcdate) survey_duration
    ,count(*) n_epoch
    ,sum(wearing) n_epoch_wearing
    ,count(lat) n_gps_fix
from (
    SELECT &#39;mtl&#39; city_id, 1 wave_id
        ,ts.*, tm.wearing
    FROM top_sd.top_1sec_mtl ts,
        top_sd.top_1min_mtl tm
    WHERE ts.interact_id = tm.interact_id AND ts.sd_id = tm.sd_id
        AND date_trunc(&#39;minute&#39;, ts.utcdate) = tm.utcdate) as foo
group by city_id, wave_id, interact_id, sd_id
  -- Get Mtl / w2
UNION
select city_id, wave_id, interact_id, sd_id
    ,min(utcdate) start_time, max(utcdate) end_time
    ,max(utcdate) - min(utcdate) survey_duration
    ,count(*) n_epoch
    ,sum(wearing) n_epoch_wearing
    ,count(lat) n_gps_fix
from (
    SELECT &#39;mtl&#39; city_id, 2 wave_id
        ,ts.*, tm.wearing
    FROM top_sd2.top_1sec_mtl ts,
        top_sd2.top_1min_mtl tm
    WHERE ts.interact_id = tm.interact_id AND ts.sd_id = tm.sd_id
        AND date_trunc(&#39;minute&#39;, ts.utcdate) = tm.utcdate) as foo
group by city_id, wave_id, interact_id, sd_id
  -- Get Mtl / w3
UNION
select city_id, wave_id, interact_id, sd_id
    ,min(utcdate) start_time, max(utcdate) end_time
    ,max(utcdate) - min(utcdate) survey_duration
    ,count(*) n_epoch
    ,sum(wearing) n_epoch_wearing
    ,count(lat) n_gps_fix
from (
    SELECT &#39;mtl&#39; city_id, 3 wave_id
        ,ts.*, tm.wearing
    FROM top_sd3.top_1sec_mtl ts,
        top_sd3.top_1min_mtl tm
    WHERE ts.interact_id = tm.interact_id AND ts.sd_id = tm.sd_id
        AND date_trunc(&#39;minute&#39;, ts.utcdate) = tm.utcdate) as foo
group by city_id, wave_id, interact_id, sd_id
  -- Get Skt / w1
UNION
select city_id, wave_id, interact_id, sd_id
    ,min(utcdate) start_time, max(utcdate) end_time
    ,max(utcdate) - min(utcdate) survey_duration
    ,count(*) n_epoch
    ,sum(wearing) n_epoch_wearing
    ,count(lat) n_gps_fix
from (
    SELECT &#39;skt&#39; city_id, 1 wave_id
        ,ts.*, tm.wearing
    FROM top_sd.top_1sec_skt ts,
        top_sd.top_1min_skt tm
    WHERE ts.interact_id = tm.interact_id AND ts.sd_id = tm.sd_id
        AND date_trunc(&#39;minute&#39;, ts.utcdate) = tm.utcdate) as foo
group by city_id, wave_id, interact_id, sd_id
  -- Get Skt / w2
UNION
select city_id, wave_id, interact_id, sd_id
    ,min(utcdate) start_time, max(utcdate) end_time
    ,max(utcdate) - min(utcdate) survey_duration
    ,count(*) n_epoch
    ,sum(wearing) n_epoch_wearing
    ,count(lat) n_gps_fix
from (
    SELECT &#39;skt&#39; city_id, 2 wave_id
        ,ts.*, tm.wearing
    FROM top_sd2.top_1sec_skt ts,
        top_sd2.top_1min_skt tm
    WHERE ts.interact_id = tm.interact_id AND ts.sd_id = tm.sd_id
        AND date_trunc(&#39;minute&#39;, ts.utcdate) = tm.utcdate) as foo
group by city_id, wave_id, interact_id, sd_id
  -- Get skt / w3
UNION
select city_id, wave_id, interact_id, sd_id
    ,min(utcdate) start_time, max(utcdate) end_time
    ,max(utcdate) - min(utcdate) survey_duration
    ,count(*) n_epoch
    ,sum(wearing) n_epoch_wearing
    ,count(lat) n_gps_fix
from (
    SELECT &#39;skt&#39; city_id, 3 wave_id
        ,ts.*, tm.wearing
    FROM top_sd3.top_1sec_skt ts,
        top_sd3.top_1min_skt tm
    WHERE ts.interact_id = tm.interact_id AND ts.sd_id = tm.sd_id
        AND date_trunc(&#39;minute&#39;, ts.utcdate) = tm.utcdate) as foo
group by city_id, wave_id, interact_id, sd_id
  -- Get van / w1
UNION
select city_id, wave_id, interact_id, sd_id
    ,min(utcdate) start_time, max(utcdate) end_time
    ,max(utcdate) - min(utcdate) survey_duration
    ,count(*) n_epoch
    ,sum(wearing) n_epoch_wearing
    ,count(lat) n_gps_fix
from (
    SELECT &#39;van&#39; city_id, 1 wave_id
        ,ts.*, tm.wearing
    FROM top_sd.top_1sec_van ts,
        top_sd.top_1min_van tm
    WHERE ts.interact_id = tm.interact_id AND ts.sd_id = tm.sd_id
        AND date_trunc(&#39;minute&#39;, ts.utcdate) = tm.utcdate) as foo
group by city_id, wave_id, interact_id, sd_id
  -- Get van / w2
UNION
select city_id, wave_id, interact_id, sd_id
    ,min(utcdate) start_time, max(utcdate) end_time
    ,max(utcdate) - min(utcdate) survey_duration
    ,count(*) n_epoch
    ,sum(wearing) n_epoch_wearing
    ,count(lat) n_gps_fix
from (
    SELECT &#39;van&#39; city_id, 2 wave_id
        ,ts.*, tm.wearing
    FROM top_sd2.top_1sec_van ts,
        top_sd2.top_1min_van tm
    WHERE ts.interact_id = tm.interact_id AND ts.sd_id = tm.sd_id
        AND date_trunc(&#39;minute&#39;, ts.utcdate) = tm.utcdate) as foo
group by city_id, wave_id, interact_id, sd_id
  -- Get van / w3
UNION
select city_id, wave_id, interact_id, sd_id
    ,min(utcdate) start_time, max(utcdate) end_time
    ,max(utcdate) - min(utcdate) survey_duration
    ,count(*) n_epoch
    ,sum(wearing) n_epoch_wearing
    ,count(lat) n_gps_fix
from (
    SELECT &#39;van&#39; city_id, 3 wave_id
        ,ts.*, tm.wearing
    FROM top_sd3.top_1sec_van ts,
        top_sd3.top_1min_van tm
    WHERE ts.interact_id = tm.interact_id AND ts.sd_id = tm.sd_id
        AND date_trunc(&#39;minute&#39;, ts.utcdate) = tm.utcdate) as foo
group by city_id, wave_id, interact_id, sd_id
  -- Get vic / w1
UNION
select city_id, wave_id, interact_id, sd_id
    ,min(utcdate) start_time, max(utcdate) end_time
    ,max(utcdate) - min(utcdate) survey_duration
    ,count(*) n_epoch
    ,sum(wearing) n_epoch_wearing
    ,count(lat) n_gps_fix
from (
    SELECT &#39;vic&#39; city_id, 1 wave_id
        ,ts.*, tm.wearing
    FROM top_sd.top_1sec_vic ts,
        top_sd.top_1min_vic tm
    WHERE ts.interact_id = tm.interact_id AND ts.sd_id = tm.sd_id
        AND date_trunc(&#39;minute&#39;, ts.utcdate) = tm.utcdate) as foo
group by city_id, wave_id, interact_id, sd_id
  -- Get vic / w2
UNION
select city_id, wave_id, interact_id, sd_id
    ,min(utcdate) start_time, max(utcdate) end_time
    ,max(utcdate) - min(utcdate) survey_duration
    ,count(*) n_epoch
    ,sum(wearing) n_epoch_wearing
    ,count(lat) n_gps_fix
from (
    SELECT &#39;vic&#39; city_id, 2 wave_id
        ,ts.*, tm.wearing
    FROM top_sd2.top_1sec_vic ts,
        top_sd2.top_1min_vic tm
    WHERE ts.interact_id = tm.interact_id AND ts.sd_id = tm.sd_id
        AND date_trunc(&#39;minute&#39;, ts.utcdate) = tm.utcdate) as foo
group by city_id, wave_id, interact_id, sd_id
-- Get vic / w3
UNION
select city_id, wave_id, interact_id, sd_id
    ,min(utcdate) start_time, max(utcdate) end_time
    ,max(utcdate) - min(utcdate) survey_duration
    ,count(*) n_epoch
    ,sum(wearing) n_epoch_wearing
    ,count(lat) n_gps_fix
from (
    SELECT &#39;vic&#39; city_id, 3 wave_id
        ,ts.*, tm.wearing
    FROM top_sd3.top_1sec_vic ts,
        top_sd3.top_1min_vic tm
    WHERE ts.interact_id = tm.interact_id AND ts.sd_id = tm.sd_id
        AND date_trunc(&#39;minute&#39;, ts.utcdate) = tm.utcdate) as foo
group by city_id, wave_id, interact_id, sd_id</code></pre>
<pre class="r"><code>head(top_1s_agg)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["city_id"],"name":[1],"type":["chr"],"align":["left"]},{"label":["wave_id"],"name":[2],"type":["int"],"align":["right"]},{"label":["interact_id"],"name":[3],"type":["int"],"align":["right"]},{"label":["sd_id"],"name":[4],"type":["int"],"align":["right"]},{"label":["start_time"],"name":[5],"type":["dttm"],"align":["right"]},{"label":["end_time"],"name":[6],"type":["dttm"],"align":["right"]},{"label":["survey_duration"],"name":[7],"type":["chr"],"align":["left"]},{"label":["n_epoch"],"name":[8],"type":["int64"],"align":["right"]},{"label":["n_epoch_wearing"],"name":[9],"type":["int64"],"align":["right"]},{"label":["n_gps_fix"],"name":[10],"type":["int64"],"align":["right"]}],"data":[{"1":"vic","2":"3","3":"103772760","4":"357","5":"2021-05-25 16:08:19","6":"2021-06-04 06:59:58","7":"9 days 14:51:39","8":"831100","9":"550140","10":"59853","_rn_":"1"},{"1":"skt","2":"2","3":"302619633","4":"312","5":"2020-10-20 13:09:32","6":"2020-10-23 14:58:38","7":"3 days 01:49:06","8":"265747","9":"145719","10":"15200","_rn_":"2"},{"1":"van","2":"3","3":"203842375","4":"451","5":"2022-07-24 13:31:40","6":"2022-08-03 06:13:11","7":"9 days 16:41:31","8":"837692","9":"589752","10":"77296","_rn_":"3"},{"1":"van","2":"1","3":"201585258","4":"445","5":"2018-08-22 14:07:11","6":"2018-09-01 03:12:32","7":"9 days 13:05:21","8":"824722","9":"431133","10":"261061","_rn_":"4"},{"1":"mtl","2":"1","3":"401178032","4":"96","5":"2019-01-11 11:41:22","6":"2019-01-21 02:10:44","7":"9 days 14:29:22","8":"829763","9":"524205","10":"275790","_rn_":"5"},{"1":"van","2":"2","3":"201140482","4":"375","5":"2020-09-10 14:59:52","6":"2020-09-27 03:35:11","7":"16 days 12:35:19","8":"1427720","9":"455100","10":"223106","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="survey-time-span" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Survey time span</h2>
<pre class="r"><code>top_1s_agg |&gt;
  mutate(
    sdate = as_date(start_time),
    edate = as_date(end_time)
  ) |&gt;
  ggplot() +
  geom_segment(
    aes(
      x = sdate,
      xend = edate,
      y = city_id,
      color = city_id
  ),
    linewidth = 2,
    alpha = .3,
    position = position_jitter(width = 0, height = .3)
  ) +
  scale_x_date(name = &quot;Survey period&quot;, date_breaks = &quot;2 month&quot;, date_labels = &quot;%b %y&quot;) +
  facet_wrap(vars(wave_id), ncol = 1, scales = &quot;free&quot;, labeller = label_both) +
  theme(legend.position = &quot;none&quot;)</code></pre>
<p><img
src="top_describe_files/figure-html/unnamed-chunk-3-1.png" /><!-- --></p>
</div>
<div id="wear-time-vs-total-survey-time" class="section level2"
number="2.3">
<h2><span class="header-section-number">2.3</span> Wear time vs total
survey time</h2>
<pre class="r"><code>top_1s_agg |&gt;
  ggplot() +
  geom_point(aes(x=n_epoch, y=n_epoch_wearing, color=factor(sd_id))) +
  xlim(0, 10 * 24 * 3600) + ylim(0, 10 * 24 * 3600) + # Define theoretical max of survey n_epoch, i.e. 10 days
  facet_grid(rows = vars(city_id), cols = vars(wave_id)) +
  theme(legend.position = &quot;none&quot;)</code></pre>
<pre><code>## Warning: Removed 156 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img
src="top_describe_files/figure-html/unnamed-chunk-4-1.png" /><!-- --></p>
<pre class="r"><code>top_1s_agg |&gt;
  mutate(`Wear time` = n_epoch_wearing / n_epoch) |&gt;
  ggplot() +
  geom_histogram(aes(x = `Wear time`)) +
  scale_x_continuous(labels = scales::percent) +
  facet_grid(rows = vars(city_id), cols = vars(wave_id), scales = &quot;free_y&quot;)</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img
src="top_describe_files/figure-html/unnamed-chunk-5-1.png" /><!-- --></p>
</div>
<div id="wear-time-with-gps-fix" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Wear time with GPS
fix</h2>
<pre class="r"><code>top_1s_agg |&gt;
  ggplot() +
  geom_point(aes(x=n_epoch_wearing, y=n_gps_fix, color=factor(sd_id))) +
  xlim(0, 10 * 24 * 3600) + ylim(0, 10 * 24 * 3600) + # Define theoretical max of survey n_epoch, i.e. 10 days
  facet_grid(rows = vars(city_id), cols = vars(wave_id)) +
  theme(legend.position = &quot;none&quot;)</code></pre>
<pre><code>## Warning: Removed 2 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img
src="top_describe_files/figure-html/unnamed-chunk-6-1.png" /><!-- --></p>
<pre class="r"><code>top_1s_agg |&gt;
  mutate(`Wear time with GPS` = pmin(n_gps_fix / n_epoch_wearing, 1)) |&gt;
  ggplot() +
  geom_histogram(aes(x = `Wear time with GPS`)) +
  scale_x_continuous(labels = scales::percent) +
  facet_grid(rows = vars(city_id), cols = vars(wave_id), scales = &quot;free_y&quot;)</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img
src="top_describe_files/figure-html/unnamed-chunk-7-1.png" /><!-- --></p>
</div>
<div id="step-statistcs" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Step statistcs</h2>
<p>Steps have been added in September 2025 following the Bernard
Asanteâs work. Steps are computing according to the Python package
<code>stepcount</code> (see <a
href="https://github.com/OxWearables/stepcount">repo</a>) based on
<em>Small SR, Chan S, Walmsley R, et al.Â (2024) Self-Supervised Machine
Learning to Characterize Step Counts from Wrist-Worn Accelerometers in
the UK Biobank. Medicine &amp; Science in Sports &amp; Exercise. DOI:
10.1249/MSS.0000000000003478</em></p>
<pre class="sql"><code>select &#39;mtl&#39; city_id, 1 wave_id,
  utcdate at time zone &#39;America/Montreal&#39; datetime,
  wearing, steps, steps_adj
from top_sd.top_1min_mtl
union
select &#39;skt&#39; city_id, 1 wave_id,
  utcdate at time zone &#39;America/Regina&#39; datetime,
  wearing, steps, steps_adj
from top_sd.top_1min_skt
union
select &#39;van&#39; city_id, 1 wave_id,
  utcdate at time zone &#39;America/Vancouver&#39; datetime,
  wearing, steps, steps_adj
from top_sd.top_1min_van
union
select &#39;vic&#39; city_id, 1 wave_id,
  utcdate at time zone &#39;America/Vancouver&#39; datetime,
  wearing, steps, steps_adj
from top_sd.top_1min_vic
union
select &#39;mtl&#39; city_id, 2 wave_id,
  utcdate at time zone &#39;America/Montreal&#39; datetime,
  wearing, steps, steps_adj
from top_sd2.top_1min_mtl
union
select &#39;skt&#39; city_id, 2 wave_id,
  utcdate at time zone &#39;America/Regina&#39; datetime,
  wearing, steps, steps_adj
from top_sd2.top_1min_skt
union
select &#39;van&#39; city_id, 2 wave_id,
  utcdate at time zone &#39;America/Vancouver&#39; datetime,
  wearing, steps, steps_adj
from top_sd2.top_1min_van
union
select &#39;vic&#39; city_id, 2 wave_id,
  utcdate at time zone &#39;America/Vancouver&#39; datetime,
  wearing, steps, steps_adj
from top_sd.top_1min_vic
union
select &#39;mtl&#39; city_id, 3 wave_id,
  utcdate at time zone &#39;America/Montreal&#39; datetime,
  wearing, steps, steps_adj
from top_sd3.top_1min_mtl
union
select &#39;skt&#39; city_id, 3 wave_id,
  utcdate at time zone &#39;America/Regina&#39; datetime,
  wearing, steps, steps_adj
from top_sd3.top_1min_skt
union
select &#39;van&#39; city_id, 3 wave_id,
  utcdate at time zone &#39;America/Vancouver&#39; datetime,
  wearing, steps, steps_adj
from top_sd3.top_1min_van
union
select &#39;vic&#39; city_id, 3 wave_id,
  utcdate at time zone &#39;America/Vancouver&#39; datetime,
  wearing, steps, steps_adj
from top_sd3.top_1min_vic</code></pre>
<div id="all-epochs" class="section level3" number="2.5.1">
<h3><span class="header-section-number">2.5.1</span> All epochs</h3>
<pre class="r"><code>top_1m |&gt;
  select(steps, steps_adj) |&gt;
  summary()</code></pre>
<pre><code>##      steps           steps_adj      
##  Min.   :  0       Min.   :  0.00   
##  1st Qu.:  0       1st Qu.:  0.00   
##  Median :  0       Median :  1.00   
##  Mean   : 17       Mean   : 16.29   
##  3rd Qu.: 23       3rd Qu.: 21.00   
##  Max.   :171       Max.   :170.00   
##  NA&#39;s   :4305757   NA&#39;s   :2866640</code></pre>
<pre class="r"><code>top_1m |&gt;
  pivot_longer(cols = starts_with(&quot;steps&quot;), names_to = &quot;method&quot;, values_to = &quot;steps&quot;, values_drop_na = T) |&gt;
  ggplot() +
  geom_freqpoly(aes(x = steps, color = method), alpha=.5, lwd=1) +
  scale_color_manual(labels = c(&quot;Raw steps&quot;, &quot;Adjusted steps&quot;), values = c(&quot;blue&quot;, &quot;red&quot;)) +
  facet_grid(rows = vars(city_id), cols = vars(wave_id)) +
  labs(title = &quot;Step distribution for raw and adjusted steps&quot;, x = &quot;Steps / minutes&quot;) +
  theme(legend.position = &quot;bottom&quot;)</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img
src="top_describe_files/figure-html/unnamed-chunk-10-1.png" /><!-- --></p>
<pre class="r"><code>top_1m |&gt;
  pivot_longer(cols = starts_with(&quot;steps&quot;), names_to = &quot;method&quot;, values_to = &quot;steps&quot;, values_drop_na = T) |&gt;
  filter(steps != 0) |&gt;
  ggplot() +
  geom_freqpoly(aes(x = steps, color = method), alpha=.5, lwd=1) +
  scale_color_manual(labels = c(&quot;Raw steps&quot;, &quot;Adjusted steps&quot;), values = c(&quot;blue&quot;, &quot;red&quot;)) +
  facet_grid(rows = vars(city_id), cols = vars(wave_id)) +
  labs(title = &quot;Step distribution for raw and adjusted steps | Minutes of zero step removed&quot;, x = &quot;Steps / minutes&quot;) +
  theme(legend.position = &quot;bottom&quot;)</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img
src="top_describe_files/figure-html/unnamed-chunk-11-1.png" /><!-- --></p>
</div>
<div id="wearing-period-epochs" class="section level3" number="2.5.2">
<h3><span class="header-section-number">2.5.2</span> Wearing period
epochs</h3>
<pre class="r"><code>top_1m |&gt;
  filter(wearing == 1) |&gt;
  select(steps, steps_adj) |&gt;
  summary()</code></pre>
<pre><code>##      steps          steps_adj      
##  Min.   :  0.00   Min.   :  0.00   
##  1st Qu.:  0.00   1st Qu.:  0.00   
##  Median :  0.00   Median :  0.00   
##  Mean   : 17.19   Mean   : 12.38   
##  3rd Qu.: 23.00   3rd Qu.: 14.00   
##  Max.   :171.00   Max.   :170.00   
##  NA&#39;s   :424653   NA&#39;s   :1952965</code></pre>
<pre class="r"><code>top_1m |&gt;
  pivot_longer(cols = starts_with(&quot;steps&quot;), names_to = &quot;method&quot;, values_to = &quot;steps&quot;, values_drop_na = T) |&gt;
  filter(wearing == 1) |&gt;
  ggplot() +
  geom_freqpoly(aes(x = steps, color = method), alpha=.5, lwd=1) +
  scale_color_manual(labels = c(&quot;Raw steps&quot;, &quot;Adjusted steps&quot;), values = c(&quot;blue&quot;, &quot;red&quot;)) +
  facet_grid(rows = vars(city_id), cols = vars(wave_id)) +
  labs(title = &quot;Step distribution for raw and adjusted steps | Wearing periods only&quot;, x = &quot;Steps / minutes&quot;) +
  theme(legend.position = &quot;bottom&quot;)</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img
src="top_describe_files/figure-html/unnamed-chunk-13-1.png" /><!-- --></p>
<pre class="r"><code>top_1m |&gt;
  pivot_longer(cols = starts_with(&quot;steps&quot;), names_to = &quot;method&quot;, values_to = &quot;steps&quot;, values_drop_na = T) |&gt;
  filter(wearing == 1 &amp; steps != 0) |&gt;
  ggplot() +
  geom_freqpoly(aes(x = steps, color = method), alpha=.5, lwd=1) +
  scale_color_manual(labels = c(&quot;Raw steps&quot;, &quot;Adjusted steps&quot;), values = c(&quot;blue&quot;, &quot;red&quot;)) +
  facet_grid(rows = vars(city_id), cols = vars(wave_id)) +
  labs(title = &quot;Step distribution for raw and adjusted steps | Wearing periods only, minutes of zero step removed&quot;, x = &quot;Steps / minutes&quot;) +
  theme(legend.position = &quot;bottom&quot;)</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img
src="top_describe_files/figure-html/unnamed-chunk-14-1.png" /><!-- --></p>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
